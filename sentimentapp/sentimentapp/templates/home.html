{% extends 'base.html' %}

{% block main %}

<div id='app'>

    <div class='row'>
      <div class='col-8 offset-2'>
        <form @submit="handleSubmit" class='mt-3' method='POST'>
          <div class="mb-3 control">
            <label for="text" class="form-label">Text to analyze</label>
            <textarea v-model='text' class="form-control" id="text" rows="3" name='text'></textarea>
          </div>

          <div class="mb-3 control">
            <input type='submit' value='Submit' class='btn btn-primary'/>
          </div>
        </form>

        <div class='mt-4' v-if="sentimentResults.length">
          <ul class='list-group'>
            <li v-for="(sr, i) in sentimentResults" :key="i"
              class='list-group-item d-flex justify-content-between align-items-center'>
              [[ sr.text ]]
              <span class="badge bg-primary rounded-pill"
                  :class="{'bg-warning': sr.polarity >= -0.2 && sr.polarity <= 0.2, 'bg-danger': sr.polarity < -0.2, 'bg-success': sr.polarity > 0.2}">
                  [[ sr.polarity.toFixed(2) ]]
              </span>
            </li>
          </ul>
        </div>

      </div>
    </div>

</div>

{% endblock %}


{% block extra_js %}
<script>
  new Vue({
    delimiters: ["[[","]]"],
    el: '#app',
    data: {
      sentimentResults: [],
      text: ''
    },
    methods: {
      handleSubmit: async function(e) {
        e.preventDefault();

        const response = await fetch('/sentiment', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({text: this.text})
        })

        const data = await response.json()
        this.sentimentResults.push(data)
        this.text = ''
      }
    }
  })
</script>
{% endblock %}
